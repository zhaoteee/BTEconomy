{"version":3,"sources":["column.js"],"names":["$","getColumns","jsonpCallbackhuspr","msg","data","bList","allColumns","rendColumns","ajax","type","url","dataType","jsonp","jsonpCallback","success","str","i","len","length","id","name","state","parseInt","html","initTags","jsonpCallbackhusab","$tagsWrapper","upColumn","jsonpCallbackhusgg","alert","modal","val","trim","num","$tagsList","find","each","this","attr","number","substr","document","cookie","split","some","x","window","location","href","$addTags","on","toggleClass","e","t","srcElement","target","$tar","nodeName","jsonpCallbackhdp","jsonpCallbackhus","removeClass","addClass","text","is","parents","confirm","curColumnTags","parent","prev","j","BList","n","leng","prop","unbind","removeAttr"],"mappings":"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","file":"column.js","sourcesContent":["$(function () {\n    // 存储所有栏目信息\n    var allColumns = [];\n    initColunm();\n    getS();\n      function getS() {\n        var ck = document.cookie.split(';');\n        var res = ck.some(function(x) {\n          if (x) {\n           return x.split('=')[0] =='name';\n          }\n        })\n        if (!res) {\n          window.location.href = './login.html';\n        }\n      }\n       //标签选择逻辑\n    var $addTags = $('.addTags');\n    var $tagsWrapper = $('.tagsWrapper');\n    var $tagsList = $('.tagsList');\n    $addTags.on('click', function () {\n        $tagsWrapper.toggleClass('height70')\n    })\n    $tagsWrapper.on('click', function (e) {\n        var t = e.srcElement ? e.srcElement : e.target;\n        var str = ''\n        var $tar = $(t)\n        if (t.nodeName === 'INPUT') {\n            var id = $tar.attr('data-id');\n            $tagsWrapper.find('input:checked').each(function () {\n                str += '<span data-id='+$(this).attr(\"data-id\")+'>'+$(this).val()+'</span>'\n            })\n            $tagsList.html(str);\n        }\n    })\n\n    function initColunm() {\n        initTags();\n        getColumns();\n    }\n    // 新建栏目\n    $('#addColumn .js-addColumn').on('click', function () {\n       var url = 'http://www.lopkj.cn:8111/lampconsole/creatProject.action';\n       upColumn(url, null)\n    })\n   \n    // 操作栏目\n    $('.columns tbody').on('click', function (e) {\n        var t = e.srcElement ? e.srcElement : e.target;\n        // 删除\n        if (t.nodeName === 'SPAN' && $(t).is('.deleteColumn')) {\n            var id = $(t).parents('tr').attr('data-id');\n            var cfm = confirm('确认删除吗？');\n            if (cfm) {\n               $.ajax({\n                    type: 'get',\n                    url: 'http://www.lopkj.cn:8111/lampconsole/deleteProject.action?id='+id,\n                    dataType:\"jsonp\",\n                    jsonp: \"callback\",\n                    jsonpCallback: 'jsonpCallbackhdp',\n                    success: function (msg) {\n                        jsonpCallbackhdp(msg);\n                    }\n                })\n                function  jsonpCallbackhdp(msg) {\n                    if (msg.state === 'success') {\n                        getColumns(); \n                    }\n                }\n            }\n        }\n        // 是否显示切换\n        if (t.nodeName === 'SPAN' && $(t).is('.changeColumn')) {\n            var id = $(t).parents('tr').attr('data-id');\n            var state = $(t).attr('state');\n            if (parseInt(state) === 2) {\n                $.ajax({\n                    type: 'get',\n                    url: 'http://www.lopkj.cn:8111/lampconsole/updateStateById.action?state=1&id='+id,\n                    dataType:\"jsonp\",\n                    jsonp: \"callback\",\n                    jsonpCallback: 'jsonpCallbackhus',\n                    success: function (msg) {\n                       jsonpCallbackhus(msg);\n                    }\n                })\n                function  jsonpCallbackhus(msg) {\n                    if (msg.state === 'success') {\n                            $(t).removeClass('label-default')\n                                .addClass('label-info')\n                                .attr('state','1')\n                                .text('显示(是)');\n                            // getColumns();\n                    }\n                } \n            } \n            if (parseInt(state) === 1) {\n                $.ajax({\n                    type: 'get',\n                    url: 'http://www.lopkj.cn:8111/lampconsole/updateStateById.action?state=2&id='+id,\n                    dataType:\"jsonp\",\n                    jsonp: \"callback\",\n                    jsonpCallback: 'jsonpCallbackhus1',\n                    success: function (msg) {\n                        jsonpCallbackhus(msg)\n                    }\n                })\n                function  jsonpCallbackhus(msg) {\n                    if (msg.state === 'success') {\n                            $(t).addClass('label-default')\n                                .removeClass('label-info')\n                                .attr('state','2')\n                                .text('显示(否)');\n                            // getColumns();\n                    }\n                }  \n            }\n          \n        }\n        // 编辑\n        if (t.nodeName === 'SPAN' && $(t).is('.editColumn')) {\n            var curColumnTags = [];\n            var str = '';\n            var id = $(t).parents('tr').attr('data-id');\n            var text = $(t).parent().parent().prev().text();\n            $('#addColumn .js-addColumn').addClass('hide');\n            $('#addColumn .js-editColumn').removeClass('hide');\n            $('#addColumn input[type=text]').val(text);\n            // 获取到当前点击栏目的关联标签信息\n            for (var j = 0, len = allColumns.length; j < len; j++) {\n                if (allColumns[j].id == id) {\n                   curColumnTags =  allColumns[j].BList;\n                   break;\n                }\n            }\n            for (var n = 0, leng = curColumnTags.length; n < leng; n++) {\n                str += '<span data-id='+curColumnTags[n].id+'>'+curColumnTags[n].name+'</span>';\n                $tagsWrapper.find('input[data-id='+curColumnTags[n].id+']').prop('checked','checked');\n            }\n            $tagsList.html(str);\n            $('#addColumn').modal('show');\n            $('#addColumn .js-editColumn').unbind('click');\n            $('#addColumn .js-editColumn').on('click', function () {\n                var url = 'http://www.lopkj.cn:8111/lampconsole/updateProject.action'\n                upColumn(url, id);\n            })\n        }\n    })\n    $('#addColumn').on('hidden.bs.modal', function () {\n        $('#addColumn input[type=\"text\"]').val('');\n        $tagsList.html('');\n        $tagsWrapper.find('input[type=\"checkbox\"]').removeAttr('checked');\n        $('#addColumn .js-addColumn').removeClass('hide');\n        $('#addColumn .js-editColumn').addClass('hide');\n    })\n\n    // 获取栏目列表数据并渲染\n    function getColumns() {\n        $.ajax({\n            type: 'get',\n            url: 'http://www.lopkj.cn:8111/lampconsole/selectProject.action',\n            dataType:\"jsonp\",\n            jsonp: \"callback\",\n            jsonpCallback: 'jsonpCallbackhuspr',\n            success: function (msg) {\n                jsonpCallbackhuspr(msg);\n            }\n        })\n        function jsonpCallbackhuspr(msg) {\n            var data = msg.bList;\n            allColumns = data;\n            rendColumns(data);\n        }\n    }\n    // 渲染栏目列表\n    function rendColumns(data) {\n        var str = '';\n        for (var i = 0, len = data.length; i < len; i++) {\n            str +=  '<tr data-id='+data[i].id+'><td class=\"text-center\">'+(i+1)+'</td>'+\n                    '<td>'+data[i].name+'</td><td><a class=\"table_operate\">'+\n                    '<span class=\"editColumn label label-success mr-5 trans\">编辑</span>'+\n                    '</a><a class=\"table_operate\">'+\n                    '<span class=\"deleteColumn label label-danger mr-5\">删除</span>'+\n                    '</a><a class=\"table_operate\">'+\n                    '<span state='+data[i].state+' class=\"changeColumn label mr-5 '+(parseInt(data[i].state) === 1 ? 'label-info' : 'label-default')+'\"'+\n                    '>'+(parseInt(data[i].state) === 1 ? '显示(是)' : '显示(否)')+'</span>'+\n                    '</a></td></tr>'\n        }\n        $('.columns tbody').html(str);\n    }\n     // 进入页面获取tags数据并更新列表\n    function initTags() {\n        $.ajax({\n            type: 'get',\n            url: 'http://www.lopkj.cn:8111/lampconsole/selectAllBall.action',\n            dataType:\"jsonp\",\n            jsonp: \"callback\",\n            jsonpCallback: 'jsonpCallbackhusab',\n            success: function (msg) {\n                jsonpCallbackhusab(msg);\n            }\n        })\n        function jsonpCallbackhusab(msg){\n            var data = msg.bList;\n            var str = '';\n            for (var i = 0, len = data.length; i < len; i++) {\n                str +=  '<label>'+data[i].name+' <input data-id='+data[i].id+' type'+\n                        '=\"checkbox\" value='+data[i].name+' /></label>'\n            }\n            $tagsWrapper.html(str);\n        }\n\n    }\n     //新建与编辑栏目\n    function upColumn(url, id) {\n        var name = $('#addColumn input[type=text]').val().trim();\n        var num = '';\n        $tagsList.find('span').each(function (i) {\n            num += $(this).attr('data-id')+',';\n        })\n        if (!name) {\n            alert('请填写栏目名');\n            return\n        }\n        if (!num) {\n            alert('请选择关联标签！');\n            return\n        }\n        var data = {}\n        if (!id) {\n            data = {\n                \"name\": name,\n                \"number\": num.substr(0, num.length-1)\n            }\n        } else {\n            data = {\n                \"name\": name,\n                \"number\": num.substr(0, num.length-1),\n                \"id\": id\n            }\n        }\n        $.ajax({\n            type: 'POST',\n            url: url,\n            dataType:\"jsonp\",\n            jsonp: \"callback\",\n            jsonpCallback: 'jsonpCallbackhusgg',\n            data: data,\n            success: function (msg) {\n                jsonpCallbackhusgg(msg);\n             }\n        })\n        function jsonpCallbackhusgg(msg) {\n            if (msg.state === '栏目已经存在') {\n                    alert('栏目已经存在')\n                }\n                if (msg.state === 'success') {\n                    getColumns();\n                    $('#addColumn').modal('hide');\n            }\n        }\n    }\n\n})"]}