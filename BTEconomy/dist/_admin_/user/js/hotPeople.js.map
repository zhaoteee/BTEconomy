{"version":3,"sources":["hotPeople.js"],"names":["$","getHotPeos","jsonpCallbackhsaj","msg","rendHotPeos","jList","ajax","type","url","dataType","jsonp","jsonpCallback","success","data","str","length","i","len","httpss","pic","id","html","alert","document","cookie","split","some","x","window","location","href","on","find","append","e","jsonpCallbackhcjd","state","jsonpCallbackhdjd","tar","srcElement","target","$tar","nodeName","is","ids","attr","imgurl","parent","prev","val","trim","console","log","unbind","change","clearFiles","self","value","this","$self","_data","files","size","exts","has","file","arr","ext","toLowerCase","indexOf","extLimit","name","form","FormData","processData","contentType","done","parents"],"mappings":"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","file":"hotPeople.js","sourcesContent":["$(function () {\n    getS();\n    function getS() {\n      var ck = document.cookie.split(';');\n      var res = ck.some(function(x) {\n        if (x) {\n         return x.split('=')[0] =='name';\n        }\n      })\n      if (!res) {\n        window.location.href = './login.html';\n      }\n    }\n   getHotPeos();\n  $('#addPeople').on('click', function () {\n    var len = $('.peoples').find('tbody tr').length+1;\n    var str = '<tr><td class=\"text-center\">'+len+'</td>'+\n              '<td><input type=\"text\" class=\"input-sm form-control\"></td><td>'+\n              '<div class=\"input-group\">'+\n              '<input type=\"text\" class=\"form-control\" value=\"\" autocomplete=\"off\">'+\n              '<div class=\"input-group-addon\">'+\n              '<label class=\"up-here\">上传图片'+\n              '<input type=\"file\" class=\"imgload-input\" name=\"fileToUpload\">'+\n              '</label></div></div></td>'+\n              '<td class=\"text-center\"><button class=\"btn btn-info keepPeo\">保存</button>'+\n              '<button class=\"btn btn-danger deletePeo\">删除</button></td></tr>';\n    $('.peoples').find('tbody').append(str);\n  })\n    $('.peoples tbody').on('click', function (e) {\n        var tar = e.srcElement ? e.srcElement : e.target;\n        var $tar = $(tar);\n        if (tar.nodeName === 'BUTTON' && $tar.is('.keepPeo')) {\n          var ids = $tar.attr('data-id') || 0;\n          var imgurl = $tar.parent().prev().find('input[type=text]').val().trim();\n          var jumpurl = $tar.parent().prev().prev().find('input[type=text]').val().trim();\n          var data = {\n            \"id\": ids,\n            \"httpss\": jumpurl,\n            \"pic\": imgurl\n          }\n          console.log(data);\n          if (!data.httpss) {\n            alert('请输入跳转链接');\n            return;\n          }if (!data.pic) {\n            alert('请上传图片');\n            return;\n          }\n          $.ajax({\n            type: 'POST',\n            url: 'http://www.lopkj.cn:8111/lampconsole/creatJdpeople.action',\n            dataType:\"jsonp\",\n            jsonp: \"callback\",\n            jsonpCallback: 'jsonpCallbackhcjd',\n            data: data,\n            success: function (msg) {\n              jsonpCallbackhcjd(msg);\n            }\n          })\n          function jsonpCallbackhcjd(msg) {\n            if (msg.state === 'success') {\n                alert('添加成功！');\n            }\n          }\n        }\n        if (tar.nodeName === 'INPUT' && $tar.is('.imgload-input')) {\n           $tar.unbind('change');\n           $tar.change(function () {\n                var self = this,\n                    $self = $(this),\n                    _data = self.files[0];\n                if (_data) {\n                    if (_data.size > (1024 * 1024 * 5)) {\n                        alert(\"请上传小于5M的图片！\");\n                        clearFiles();\n                        return;\n                    }\n\n                    if (!extLimit(['jpg', 'png', 'gif', 'bmp', 'jpeg']).has(_data.name)) {\n                        alert(\"请上传正确的图片！\");\n                        clearFiles();\n                        return;\n                    }\n\n                    var form = new FormData();\n                    form.append(\"fileToUpload\", _data);\n\n                    $.ajax({ //\n                        url : \"http://www.lopkj.cn:8111/lampconsole/UploadServlet.action\",\n                        type : \"POST\",\n                        data : form,\n                        processData : false,\n                        contentType : false,\n                        dataType : \"JSON\"\n                    }).done(function(data) {\n                        if (data.data) {\n                            $self.parents('td').find('input[type=text]').val(data.data[0]);\n                        } else {\n                            alert(\"上传失败，请重新再试\");\n                        }\n\n                        clearFiles();\n                    });\n                }\n                function clearFiles() {\n                    self.value = \"\";\n                }\n                function extLimit(exts) {\n                    return {\n                        has : function(file) {\n                            var arr = file.split(\".\"),\n                                ext = arr[arr.length - 1].toLowerCase();\n\n                            return exts.indexOf(ext) > -1 ? true : false;\n                        }\n                    };\n                }\n          });\n        }\n        if (tar.nodeName === 'BUTTON' && $tar.is('.deletePeo')) {\n            var id = $tar.attr('data-id');\n            if (id) {\n                $.ajax({\n                    type: 'GET',\n                    url: 'http://www.lopkj.cn:8111/lampconsole/deletetJdpeople.action?id='+id,\n                    dataType:\"jsonp\",\n                    jsonp: \"callback\",\n                    jsonpCallback: 'jsonpCallbackhdjd',\n                    success: function (msg) {\n                      jsonpCallbackhdjd(msg);\n                    }\n                })\n                function jsonpCallbackhdjd(msg) {\n                  if (msg.state === 'success') {\n                        getHotPeos();\n                        alert('删除成功！');\n                  }\n                }\n            }\n        }\n    })\n\n    // 获取列表数据并渲染\n    function getHotPeos() {\n        $.ajax({\n          type: 'get',\n          url: 'http://www.lopkj.cn:8111/lampconsole/selectAllJdpeople.action',\n          dataType:\"jsonp\",\n          jsonp: \"callback\",\n          jsonpCallback: 'jsonpCallbackhsaj',\n          success: function (msg) {\n            jsonpCallbackhsaj(msg);\n          }\n        })\n        function jsonpCallbackhsaj(msg) {\n          var data = msg.jList;\n          rendHotPeos(data);\n        }\n    }\n    function rendHotPeos(data) {\n        var str = '';\n        if (!data.length) {\n          alert('暂无焦点人物，请添加');\n          return;\n        }\n        for (var i = 0, len = data.length; i < len; i++) {\n          str += '<tr><td class=\"text-center\">'+(i+1)+'</td>'+\n                '<td><input type=\"text\" class=\"input-sm form-control\" value='+data[i].httpss+'></td>'+\n                '<td><div class=\"input-group\">'+\n                '<input type=\"text\" class=\"form-control\" autocomplete=\"off\" value='+data[i].pic+'>'+\n                '<div class=\"input-group-addon\">'+\n                '<label class=\"up-here\">上传图片'+\n                '<input type=\"file\" class=\"imgload-input\" name=\"fileToUpload\">'+\n                '</label></div></div></td>'+\n                '<td class=\"text-center\">'+\n                '<button data-id='+data[i].id+' class=\"btn btn-info keepPeo\">保存</button>'+\n                '<button data-id='+data[i].id+' class=\"btn btn-danger deletePeo\">删除</button></td></tr>'\n        }\n        $('.peoples tbody').html(str);\n    }\n})"]}