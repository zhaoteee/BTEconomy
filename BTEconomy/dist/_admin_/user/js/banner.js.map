{"version":3,"sources":["banner.js"],"names":["$","rendBanners","data","str","length","i","len","name","httpss","pic","id","html","alert","jsonpCallbackhsa","msg","jList","ajax","type","url","dataType","jsonp","jsonpCallback","success","getBanners","document","cookie","split","some","x","window","location","href","on","e","jsonpCallbackhcp","state","tar","srcElement","target","$tar","nodeName","is","ids","attr","imgurl","parent","prev","find","val","trim","jumpurl","console","log","unbind","change","clearFiles","self","value","this","$self","_data","files","size","exts","has","file","arr","ext","toLowerCase","indexOf","extLimit","form","FormData","append","processData","contentType","done","jsonpCallbackhu","parents"],"mappings":"AAAAA,EAAE,WAgIA,SAASC,EAAYC,GACnB,IAAIC,EAAM,GACV,GAAKD,EAAKE,OAAV,CAIA,IAAK,IAAIC,EAAI,EAAGC,EAAMJ,EAAKE,OAAQC,EAAIC,EAAKD,IAC1CF,GAAO,kEAAkED,EAAKG,GAAGE,KAAK,oEACjBL,EAAKG,GAAGG,OAAO,wGAERN,EAAKG,GAAGI,IAAI,wKAI9DP,EAAKG,GAAGK,GAAG,sDAEvCV,EAAE,kBAAkBW,KAAKR,QAbvBS,MAAM,cAnBV,WAWE,SAASC,EAAiBC,GAEtBb,EADSa,EAAIC,OAXjBf,EAAEgB,MACAC,KAAM,MACNC,IAAK,6DACLC,SAAS,QACTC,MAAO,WACPC,cAAe,mBACfC,QAAS,SAAUR,GACjBD,EAAiBC,MAvHvBS,GAGWC,SAASC,OAAOC,MAAM,KAClBC,KAAK,SAASC,GACzB,GAAIA,EACH,MAAyB,QAAlBA,EAAEF,MAAM,KAAK,OAIrBG,OAAOC,SAASC,KAAO,gBAG3B/B,EAAE,kBAAkBgC,GAAG,QAAS,SAAUC,GAoCtC,SAASC,EAAiBpB,GACL,YAAdA,EAAIqB,OACLvB,MAAM,QArCd,IAAIwB,EAAMH,EAAEI,WAAaJ,EAAEI,WAAaJ,EAAEK,OACtCC,EAAOvC,EAAEoC,GACb,GAAqB,WAAjBA,EAAII,UAAyBD,EAAKE,GAAG,YAAa,CACpD,IAAIC,EAAMH,EAAKI,KAAK,YAAc,EAC9BC,EAASL,EAAKM,SAASC,OAAOC,KAAK,oBAAoBC,MAAMC,OAC7DC,EAAUX,EAAKM,SAASC,OAAOA,OAAOC,KAAK,oBAAoBC,MAAMC,OAErE/C,GACFQ,GAAMgC,EACNnC,KAHUgC,EAAKM,SAASC,OAAOA,OAAOA,OAAOC,KAAK,oBAAoBC,MAAMC,OAI5EzC,OAAU0C,EACVzC,IAAOmC,GAGT,GADAO,QAAQC,IAAIlD,IACPA,EAAKK,KAER,YADAK,MAAM,SAEP,IAAKV,EAAKM,OAET,YADAI,MAAM,WAEP,IAAKV,EAAKO,IAET,YADAG,MAAM,SAGRZ,EAAEgB,MACAC,KAAM,OACNC,IAAK,yDACLC,SAAS,QACTC,MAAO,WACPC,cAAe,mBACfnB,KAAMA,EACNoB,QAAS,SAAUR,GACjBoB,EAAiBpB,MASF,UAAjBsB,EAAII,UAAwBD,EAAKE,GAAG,oBACtCF,EAAKc,OAAO,UACXd,EAAKe,OAAO,WAqCX,SAASC,IACLC,EAAKC,MAAQ,GArCjB,IAAID,EAAOE,KACPC,EAAQ3D,EAAE0D,MACVE,EAAQJ,EAAKK,MAAM,GACvB,GAAID,EAAO,CACP,GAAIA,EAAME,KAAO,QAGb,OAFAlD,MAAM,oBACN2C,IAIJ,IA6BJ,SAAkBQ,GACd,OACIC,IAAM,SAASC,GACX,IAAIC,EAAMD,EAAKvC,MAAM,KACjByC,EAAMD,EAAIA,EAAI9D,OAAS,GAAGgE,cAE9B,OAAOL,EAAKM,QAAQF,IAAQ,IAnC/BG,EAAU,MAAO,MAAO,MAAO,MAAO,SAASN,IAAIJ,EAAMrD,MAG1D,OAFAK,MAAM,kBACN2C,IAIJ,IAAIgB,EAAO,IAAIC,SACfD,EAAKE,OAAO,eAAgBb,GAE5B5D,EAAEgB,MACEE,IAAM,4DACND,KAAO,OACPf,KAAOqE,EACPG,aAAc,EACdC,aAAc,EACdxD,SAAW,SACZyD,KAAK,SAAS1E,GACf2E,gBAAgB3E,GACVA,EAAKA,KACLyD,EAAMmB,QAAQ,MAAM/B,KAAK,oBAAoBC,IAAI9C,EAAKA,KAAK,IAE3DU,MAAM,cAEV2C","file":"banner.js","sourcesContent":["$(function() {\n  getBanners();\n  getS();\n  function getS() {\n    var ck = document.cookie.split(';');\n    var res = ck.some(function(x) {\n      if (x) {\n       return x.split('=')[0] =='name';\n      }\n    })\n    if (!res) {\n      window.location.href = './login.html';\n    }\n  }\n  $('.banners tbody').on('click', function (e) {\n    var tar = e.srcElement ? e.srcElement : e.target;\n    var $tar = $(tar);\n    if (tar.nodeName === 'BUTTON' && $tar.is('.keepBan')) {\n      var ids = $tar.attr('data-id') || 0;\n      var imgurl = $tar.parent().prev().find('input[type=text]').val().trim();\n      var jumpurl = $tar.parent().prev().prev().find('input[type=text]').val().trim();\n      var title = $tar.parent().prev().prev().prev().find('input[type=text]').val().trim();\n      var data = {\n        \"id\": ids,\n        \"name\": title,\n        \"httpss\": jumpurl,\n        \"pic\": imgurl\n      }\n      console.log(data);\n      if (!data.name) {\n        alert('请输入标题');\n        return;\n      }if (!data.httpss) {\n        alert('请输入跳转链接');\n        return;\n      }if (!data.pic) {\n        alert('请上传图片');\n        return;\n      }\n      $.ajax({\n        type: 'POST',\n        url: 'http://www.lopkj.cn:8111/lampconsole/creatJdpic.action',\n        dataType:\"jsonp\",\n        jsonp: \"callback\",\n        jsonpCallback: 'jsonpCallbackhcp',\n        data: data,\n        success: function (msg) {\n          jsonpCallbackhcp(msg);\n        }\n      })\n      function jsonpCallbackhcp(msg) {\n         if (msg.state === 'success') {\n            alert('保存成功');\n          }\n      }\n    }\n    if (tar.nodeName === 'INPUT' && $tar.is('.imgload-input')) {\n      $tar.unbind('change');\n       $tar.change(function () {\n        var self = this,\n            $self = $(this),\n            _data = self.files[0];\n        if (_data) {\n            if (_data.size > (1024 * 1024 * 5)) {\n                alert(\"请上传小于5M的图片！\");\n                clearFiles();\n                return;\n            }\n\n            if (!extLimit(['jpg', 'png', 'gif', 'bmp', 'jpeg']).has(_data.name)) {\n                alert(\"请上传正确的图片！\");\n                clearFiles();\n                return;\n            }\n\n            var form = new FormData();\n            form.append(\"fileToUpload\", _data);\n\n            $.ajax({ //\n                url : \"http://www.lopkj.cn:8111/lampconsole/UploadServlet.action\",\n                type : \"POST\",\n                data : form,\n                processData : false,\n                contentType : false,\n                dataType : \"JSON\"\n            }).done(function(data) {\n              jsonpCallbackhu(data);\n                if (data.data) {\n                    $self.parents('td').find('input[type=text]').val(data.data[0]);\n                } else {\n                    alert(\"上传失败，请重新再试\");\n                }\n                clearFiles();\n            });\n        }\n        function clearFiles() {\n            self.value = \"\";\n        }\n        function extLimit(exts) {\n            return {\n                has : function(file) {\n                    var arr = file.split(\".\"),\n                        ext = arr[arr.length - 1].toLowerCase();\n\n                    return exts.indexOf(ext) > -1 ? true : false;\n                }\n            };\n        }\n      });\n    }\n  })\n  // 获取栏目列表数据并渲染\n  function getBanners() {\n    $.ajax({\n      type: 'get',\n      url: 'http://www.lopkj.cn:8111/lampconsole/selectAllJdpic.action',\n      dataType:\"jsonp\",\n      jsonp: \"callback\",\n      jsonpCallback: 'jsonpCallbackhsa',\n      success: function (msg) {\n        jsonpCallbackhsa(msg);\n      }\n    })\n    function jsonpCallbackhsa(msg) {\n      var data = msg.jList;\n        rendBanners(data);\n    }\n  }\n  function rendBanners(data) {\n    var str = '';\n    if (!data.length) {\n      alert('暂无焦点图，请添加');\n      return;\n    }\n    for (var i = 0, len = data.length; i < len; i++) {\n      str += '<tr><td><input type=\"text\" class=\"input-sm form-control\" value='+data[i].name+'></td>'+\n             '<td><input type=\"text\" class=\"input-sm form-control\" value='+data[i].httpss+'></td><td>'+\n             '<div class=\"input-group\">'+\n             '<input type=\"text\" class=\"form-control\"  autocomplete=\"off\" value='+data[i].pic+'>'+\n             '<div class=\"input-group-addon\"><label class=\"up-here\">上传图片'+\n             '<input type=\"file\" class=\"imgload-input\" name=\"fileToUpload\"></label>'+\n             '</div></div></td><td>'+\n             '<button data-id='+data[i].id+' class=\"btn btn-info keepBan\">保存</button></td></tr>';\n    }\n    $('.banners tbody').html(str);\n  }\n})"]}