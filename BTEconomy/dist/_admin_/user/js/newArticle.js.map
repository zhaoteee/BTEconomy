{"version":3,"sources":["newArticle.js"],"names":["$","keepAndEdit","url","data","ajax","type","success","msg","obj","JSON","parse","state","alert","window","location","href","getArticleInfo","articleid","insertInfo","word","str","$articleTitle","val","name","$articleSubtitle","fname","$articleAuthor","userr","$articleSource","source","$articleSmallimg","pic","n","leng","bList","length","id","$tagsWrapper","find","prop","$tagsList","html","editor","txt","i","len","aid","split","getUrl","document","cookie","some","x","E","wangEditor","customConfig","uploadFileName","uploadImgServer","uploadImgMaxSize","create","$addTags","on","toggleClass","e","t","srcElement","target","$tar","nodeName","attr","each","this","change","clearFiles","self","value","$self","_data","files","size","exts","has","file","arr","ext","toLowerCase","indexOf","extLimit","form","FormData","append","processData","contentType","dataType","done","parents","prev","getElementById","onclick","num","trim","user","number","substr"],"mappings":"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","file":"newArticle.js","sourcesContent":["$(function () {\n    initTags();\n    // 根据课程id获取课程信息\n    var articleid = 0;\n    getUrl();\n    getS();\n    function getS() {\n        var ck = document.cookie.split(';');\n        var res = ck.some(function(x) {\n          if (x) {\n           return x.split('=')[0] =='name';\n          }\n        })\n        if (!res) {\n          window.location.href = './login.html';\n        }\n      }\n    // 渲染富文本编辑器\n    var E = window.wangEditor;\n    var editor = new E('#editor');\n    // editor.customConfig.uploadImgShowBase64 = true;\n    editor.customConfig.uploadFileName = 'fileToUpload'\n    editor.customConfig.uploadImgServer = \"http://www.lopkj.cn:8111/lampconsole/UploadServlet.action\";\n    editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024;\n    editor.create();\n    var $articleTitle = $('.articleTitle');\n    var $articleSubtitle = $('.articleSubtitle');\n    var $articleSmallimg = $('.articleSmallimg');\n    var $articleAuthor = $('.articleAuthor');\n    var $articleSource = $('.articleSource');\n\n   \n    //js逻辑\n    var $addTags = $('.addTags');\n    var $tagsWrapper = $('.tagsWrapper');\n    var $tagsList = $('.tagsList');\n    $addTags.on('click', function () {\n        $tagsWrapper.toggleClass('height70')\n    })\n    $tagsWrapper.on('click', function (e) {\n        var t = e.srcElement ? e.srcElement : e.target;\n        var str = ''\n        var $tar = $(t)\n        if (t.nodeName === 'INPUT') {\n            var id = $tar.attr('data-id');\n            $tagsWrapper.find('input:checked').each(function () {\n                str += '<span data-id='+$(this).attr(\"data-id\")+'>'+$(this).val()+'</span>'\n            })\n            $tagsList.html(str);\n        }\n    })\n     $('.imgload-input').change(function () {\n        var self = this,\n            $self = $(this),\n            _data = self.files[0];\n        if (_data) {\n            if (_data.size > (1024 * 1024 * 5)) {\n                alert(\"请上传小于5M的图片！\");\n                clearFiles();\n                return;\n            }\n\n            if (!extLimit(['jpg', 'png', 'gif', 'bmp', 'jpeg']).has(_data.name)) {\n                alert(\"请上传正确的图片！\");\n                clearFiles();\n                return;\n            }\n\n            var form = new FormData();\n            form.append(\"fileToUpload\", _data);\n\n            $.ajax({ //\n                url : \"http://www.lopkj.cn:8111/lampconsole/UploadServlet.action\",\n                type : \"POST\",\n                data : form,\n                processData : false,\n                contentType : false,\n                dataType : \"JSON\"\n            }).done(function(data) {\n                if (data.data) {\n                    $self.parents('div.input-group-addon').prev().val(data.data[0]);\n                } else {\n                    alert(\"上传失败，请重新再试\");\n                }\n\n                clearFiles();\n            });\n        }\n        function clearFiles() {\n            self.value = \"\";\n        }\n        function extLimit(exts) {\n            return {\n                has : function(file) {\n                    var arr = file.split(\".\"),\n                        ext = arr[arr.length - 1].toLowerCase();\n\n                    return exts.indexOf(ext) > -1 ? true : false;\n                }\n            };\n        }\n      });\n    document.getElementById('publishArticle').onclick = function () {\n        var num = '';\n        var url ='';\n        $tagsList.find('span').each(function (i) {\n            num += $(this).attr('data-id')+',';\n        })\n        var data = {\n            \"name\": $articleTitle.val().trim(),\n            \"fname\": $articleSubtitle.val().trim(),\n            \"pic\": $articleSmallimg.val(),\n            \"user\": $articleAuthor.val().trim(),\n            \"source\": $articleSource.val().trim(),\n            \"word\": editor.txt.html(),\n            \"number\": num.substr(0, num.length-1),\n            \"id\": articleid\n        }\n        if (!data.name) {\n            alert(\"请输入文章标题！\")\n            return;\n        }if (!data.fname) {\n            alert(\"请输入文章副标题！\")\n            return;\n        }if (!data.pic) {\n            alert(\"请输入文章缩略图！\")\n            return;\n        }if (!data.user) {\n            alert(\"请输入文章作者名称！\")\n            return;\n        }if (!data.source) {\n            alert(\"请输入文章来源！\")\n            return;\n        }if (!data.number) {\n            alert(\"请选择文章标签！\")\n            return;\n        }\n        if (articleid) {\n            url = 'http://www.lopkj.cn:8111/lampconsole/updateWordsById.action'\n        } else {\n            url = 'http://www.lopkj.cn:8111/lampconsole/creatWords.action'\n        }\n        keepAndEdit(url, data);\n    }\n    // 保存或编辑文章\n    function keepAndEdit(url, data) {\n        $.ajax({\n            type: 'POST',\n            url: url,\n            data: data,\n            success: function (msg) {\n                var obj = JSON.parse(msg);\n                if (obj.state === 'success') {\n                    alert('上传成功！');\n                    window.location.href='./articles.html'\n                } else if (obj.state === '文章已存在') {\n                    alert('文章已存在');\n                } \n             }\n        })\n    }\n    // 进入页面获取tags数据并更新列表\n    function initTags() {\n        $.ajax({\n            type: 'get',\n            url: 'http://www.lopkj.cn:8111/lampconsole/selectAllBall.action',\n            success: function (msg) {\n                var obj = JSON.parse(msg);\n                var data = obj.bList;\n                var str = '';\n                for (var i = 0, len = data.length; i < len; i++) {\n                    str +=  '<label>'+data[i].name+' <input data-id='+data[i].id+' type'+\n                            '=\"checkbox\" value='+data[i].name+' /></label>'\n                }\n                $tagsWrapper.html(str);\n            }\n        })\n    }\n    //  获取url\n    function getUrl() {\n        var url = window.location.href;\n        var aid = url.split('?')[1]\n        if (aid) {\n            aid = aid.split('&')[0]\n        }\n        if (aid && aid.split('=')[0]==='id') {\n            articleid = aid.split('=')[1];\n            getArticleInfo(articleid);\n        }\n    }\n    // 获取对于id的课程信息\n    function getArticleInfo(articleid) {\n        $.ajax({\n            type: 'get',\n            url: 'http://www.lopkj.cn:8111/lampconsole/selectWordsById.action?id='+articleid,\n            success: function (msg) {\n                var obj = JSON.parse(msg);\n                var data = obj.word;\n                insertInfo(data);\n            }\n        })\n    }\n    // 填入课程信息\n    function insertInfo(data) {\n        var str = '';\n        $articleTitle.val(data.name);\n        $articleSubtitle.val(data.fname);\n        $articleAuthor.val(data.userr);\n        $articleSource.val(data.source);\n        $articleSmallimg.val(data.pic)\n        for (var n = 0, leng = data.bList.length; n < leng; n++) {\n            str += '<span data-id='+data.bList[n].id+'>'+data.bList[n].name+'</span>';\n            $tagsWrapper.find('input[data-id='+data.bList[n].id+']').prop('checked','checked');\n        }\n        $tagsList.html(str);\n        editor.txt.html(data.word);\n    }\n})"]}