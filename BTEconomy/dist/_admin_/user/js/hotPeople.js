$(function(){function t(){function t(t){e(t.jList)}$.ajax({type:"get",url:"http://www.lopkj.cn:8111/lampconsole/selectAllJdpeople.action",dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallbackhsaj",success:function(e){t(e)}})}function e(t){var e="";if(t.length){for(var n=0,a=t.length;n<a;n++)e+='<tr><td class="text-center">'+(n+1)+'</td><td><input type="text" class="input-sm form-control" value='+t[n].httpss+'></td><td><div class="input-group"><input type="text" class="form-control" autocomplete="off" value='+t[n].pic+'><div class="input-group-addon"><label class="up-here">上传图片<input type="file" class="imgload-input" name="fileToUpload"></label></div></div></td><td class="text-center"><button data-id='+t[n].id+' class="btn btn-info keepPeo">保存</button><button data-id='+t[n].id+' class="btn btn-danger deletePeo">删除</button></td></tr>';$(".peoples tbody").html(e)}else alert("暂无焦点人物，请添加")}document.cookie.split(";").some(function(t){if(t)return"name"==t.split("=")[0]})||(window.location.href="./login.html"),t(),$("#addPeople").on("click",function(){var t='<tr><td class="text-center">'+($(".peoples").find("tbody tr").length+1)+'</td><td><input type="text" class="input-sm form-control"></td><td><div class="input-group"><input type="text" class="form-control" value="" autocomplete="off"><div class="input-group-addon"><label class="up-here">上传图片<input type="file" class="imgload-input" name="fileToUpload"></label></div></div></td><td class="text-center"><button class="btn btn-info keepPeo">保存</button><button class="btn btn-danger deletePeo">删除</button></td></tr>';$(".peoples").find("tbody").append(t)}),$(".peoples tbody").on("click",function(e){function n(t){"success"===t.state&&alert("添加成功！")}function a(e){"success"===e.state&&(t(),alert("删除成功！"))}var o=e.srcElement?e.srcElement:e.target,l=$(o);if("BUTTON"===o.nodeName&&l.is(".keepPeo")){var p=l.attr("data-id")||0,s=l.parent().prev().find("input[type=text]").val().trim(),i={id:p,httpss:l.parent().prev().prev().find("input[type=text]").val().trim(),pic:s};if(console.log(i),!i.httpss)return void alert("请输入跳转链接");if(!i.pic)return void alert("请上传图片");$.ajax({type:"POST",url:"http://www.lopkj.cn:8111/lampconsole/creatJdpeople.action",dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallbackhcjd",data:i,success:function(t){n(t)}})}if("INPUT"===o.nodeName&&l.is(".imgload-input")&&(l.unbind("change"),l.change(function(){function t(){e.value=""}var e=this,n=$(this),a=e.files[0];if(a){if(a.size>5242880)return alert("请上传小于5M的图片！"),void t();if(!function(t){return{has:function(e){var n=e.split("."),a=n[n.length-1].toLowerCase();return t.indexOf(a)>-1}}}(["jpg","png","gif","bmp","jpeg"]).has(a.name))return alert("请上传正确的图片！"),void t();var o=new FormData;o.append("fileToUpload",a),$.ajax({url:"http://www.lopkj.cn:8111/lampconsole/UploadServlet.action",type:"POST",data:o,processData:!1,contentType:!1,dataType:"JSON"}).done(function(e){e.data?n.parents("td").find("input[type=text]").val(e.data[0]):alert("上传失败，请重新再试"),t()})}})),"BUTTON"===o.nodeName&&l.is(".deletePeo")){var c=l.attr("data-id");c&&$.ajax({type:"GET",url:"http://www.lopkj.cn:8111/lampconsole/deletetJdpeople.action?id="+c,dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallbackhdjd",success:function(t){a(t)}})}})});
//# sourceMappingURL=hotPeople.js.map
